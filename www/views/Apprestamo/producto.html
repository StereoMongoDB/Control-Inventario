<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Producto</title>
    <link rel="icon" type="image/x-icon" href="../../public/img/logo-icon.ico">
    <link rel="stylesheet" href="../../public/css/producto.css">
    <link rel="stylesheet" href="../../public/css/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../public/css/bootstrap-icons/font/bootstrap-icons.css">
    <script src="../../public/js/jquery/dist/jquery.min.js"></script>
    <script src="../../public/js/sessionhandler.js"></script>
    <style>
        .product-details {
            padding: 20px;
            margin-bottom: 60px; /* Asegura suficiente espacio para el botón */
        }

        .loan-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            text-align: center;
            text-decoration: none;
        }

        .loan-button:hover {
            background-color: #0056b3;
        }
    </style>
    <style>

        body{
            overflow: auto;
            height: auto;
        }
        
        #sidebar {
            position: fixed;
            top: 0;
            left: -250px; /* Oculta el sidebar fuera de la pantalla */
            width: 250px;
            height: 100%;
            background-color: #2a3240;
            transition: left 0.3s ease;
            overflow-y: auto; /* Agrega desplazamiento vertical */
        }
        
        #sidebar.show {
            left: 0; /* Muestra el sidebar al desplazarlo a la posición deseada */
        }
        
        #sidebar.hidden {
            left: -250px; /* Oculta el sidebar fuera de la pantalla */
        }
        
        #sidebar ul {
            list-style-type: none;
            padding: 0;
        }
        
        #sidebar ul li {
            margin: 10px 0;
        }
        
        #sidebar ul li a {
            text-decoration: none;
        }
        
        #sidebar ul li a button {
            width: 100%;
            padding: 10px;
            border: none;
            text-align: left;
            display: block;
            font-size: 16px;
            cursor: pointer;
        }
        
        #sidebar ul li a button.blue-button {
            background-color: #007bff;
            color: white;
        }
        
        #sidebar ul li a button.gray-button {
            background-color: #6c757d;
            color: white;
        }
        
        #sidebar ul li a button.red-button {
            background-color: #dc3545;
            color: white;
        }
        
        #sidebar ul li a button.orange-button {
            background-color: #fd7e14;
            color: white;
        }
        
        #sidebar ul li a button.green-button {
            background-color: #28a745;
            color: white;
        }
        
        #sidebar ul li a button:hover {
            opacity: 0.8;
        }
        
        /* Remove underline and blue border on hover */
        #sidebar ul li a:hover, #sidebar ul li a:focus {
            text-decoration: none;
        }
        
        #sidebar ul li a button:focus {
            outline: none;
        }
        
        /* Estilos para el icono de menú */
        #menu-icon {
            font-size: 24px; /* Ajusta el tamaño según sea necesario */
            cursor: pointer;
        }
        
        /* Estilos para las imágenes de los productos */
        .products {
            display: flex;
            flex-wrap: wrap;
        }
        
        .product {
            display: block;
            text-align: center;
            margin: 10px;
            flex: 1 1 45%;
        }
        
        .product img {
            width: 100%;
            max-width: 200px; /* Establece un tamaño máximo para las imágenes */
            height: auto; /* Mantiene la proporción de la imagen */
        }
        
        .product p {
            margin-top: 10px;
        }
        
        /* Additional styles for scrolling, search, and pagination */
        .products-container {
            overflow-y: auto; /* Adjust as necessary */
        }
        
        .search-container {
            margin-bottom: 20px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        
        .pagination button {
            margin: 0 5px;
            padding: 5px 10px;
        }
        
        /* Media query para pantallas más grandes */
        @media (min-width: 768px) {
            .pagination {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
            }
        }
        
        #searchInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
        }
        </style>
</head>
<body>
    <header>
        <img src="../../public/img/logo.png" alt="Logo">
        <div class="user-info">
            <span id="user-name"></span>
            <span id="menu-icon" onclick="toggleSidebar()">☰</span>
        </div>
    </header>
    
    <div id="sidebar" class="hidden">
        <ul>
            <li id="historialLink" style="display: none;">
                <a href="../../init.html" onclick="">
                    <button class="gray-button">Inicio</button>
                </a>
            </li>
            <li><a href="../../views/Apprestamo/notificaciones.html"><button class="orange-button">Avisos</button></a></li>
            <li id="adminLink" style="display:none;"><a href="../../admin.html"><button class="green-button">Administrador</button></a></li>
            <li><button class="red-button" onclick="cerrarSesion()">Cerrar sesión</button></li>
        </ul>
    </div>
    <main>
        <div class="product-images">
            <img id="productImage" src="../../public/img/placeholder.png" alt="Producto" style="display: none;">
        </div>
        <div class="product-details">
            <h1 class="product-name" id="productName">Nombre del producto</h1>
            <a id="loanButton" href="#" class="loan-button">Solicitar préstamo</a>
            <table class="product-info">
                <tr>
                    <td>Marca:</td>
                    <td id="productBrand">Marca</td>
                </tr>
                <tr>
                    <td>Área:</td>
                    <td id="productArea">Área</td>
                </tr>
                <tr>
                    <td>Número de Serie:</td>
                    <td id="productSerialNumber">Número de Serie</td>
                </tr>
                <tr>
                    <td>Existencia:</td>
                    <td id="productQuantity">Cantidad</td>
                </tr>
                <tr>
                    <td>Ubicación:</td>
                    <td id="productLocation">Ubicación</td>
                </tr>
                <tr>
                    <td>Estado:</td>
                    <td id="productState" class="estado">Estado</td>
                </tr>
            </table>
            <div class="product-description">
                <h2>Descripción</h2>
                <p id="productDescription">Descripción del producto</p>
            </div>
        </div>
    </main>

    <footer>
        &copy; 2024 UTTN
    </footer>

    <script>
        $(document).ready(function() {
            const materialId = getMaterialIdFromUrl();
            if (materialId) {
                fetchMaterialDetails(materialId);
                $('#loanButton').attr('href', `../Apprestamo/prestamo.html?producto=${materialId}`);
            } else {
                alert('ID de producto no proporcionado en la URL');
            }
        });

        function getMaterialIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('producto');
        }

        function fetchMaterialDetails(id) {
            $.ajax({
                url: `https://vaelsaki.bsite.net/api/materiales/${id}`,
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    if (data) {
                        $('#productName').text(data.nombre || 'Nombre del producto');
                        $('#productSerialNumber').text(data.num_serie || 'Número de Serie');
                        $('#productQuantity').text(data.cantidad_existencia || 'Cantidad');
                        $('#productLocation').text(data.ubicacion || 'Ubicación');
                        $('#productDescription').text(data.descripcion || 'Descripción del producto');

                        if (data.Imagen_Id) {
                            $('#productImage').attr('src', `https://vaelsaki.bsite.net/api/imagenes/${data.Imagen_Id}`);
                            $('#productImage').show();
                        }

                        fetchRelatedDetails(data);
                    } else {
                        alert('No se encontraron detalles del producto');
                    }
                },
                error: function(error) {
                    console.error('Error al obtener los detalles del producto:', error);
                    alert('Error al cargar los detalles del producto');
                }
            });
        }

        function fetchRelatedDetails(data) {
            // Fetch Areas
            $.ajax({
                url: 'https://vaelsaki.bsite.net/api/AreasConDepartamentos',
                method: 'GET',
                success: function(areas) {
                    // Find the area with the matching ID
                    const area = areas.find(a => a.Id_Area === data.Area_Id);
                    $('#productArea').text(area ? `(${area.DepartamentoNombre}) ${area.area1 || 'Área'}` : 'Área no encontrada');
                },
                error: function(error) {
                    console.error('Error al obtener las áreas:', error);
                }
            });

            // Fetch Marca
            $.ajax({
                url: `https://vaelsaki.bsite.net/api/marcas/${data.Marca_Id}`,
                method: 'GET',
                success: function(marca) {
                    $('#productBrand').text(marca.marca1 || 'Marca');
                },
                error: function(error) {
                    console.error('Error al obtener la marca:', error);
                }
            });

            // Fetch Estado
            $.ajax({
                url: `https://vaelsaki.bsite.net/api/estadoes/${data.Estado_Id}`,
                method: 'GET',
                success: function(estado) {
                    $('#productState').text(estado.estado1 || 'Estado');
                },
                error: function(error) {
                    console.error('Error al obtener el estado:', error);
                }
            });

            // Fetch Actualizacion (if needed)
            $.ajax({
                url: `https://vaelsaki.bsite.net/api/actualizaciones/${data.Actualizacion_Id}`,
                method: 'GET',
                success: function(actualizacion) {
                    // Handle the actualizacion if necessary
                },
                error: function(error) {
                    console.error('Error al obtener la actualización:', error);
                }
            });
        }
    </script>
    <script src="../../public/js/index.js"></script>
    <script>showUser();</script>
</body>
</html>
